(()=>{"use strict";var e,t={840:(e,t,i)=>{var n=i(728),s=i(844);var o=i(292),r=i.n(o);function a(e){return r()(`game:${e}`)}r().enable("*");class c extends Phaser.GameObjects.Image{constructor(e,t,i){super(e,t,i,"body.blue.1"),e.add.existing(this),this.setDepth(100)}}const l=a("client:body-synchronizer");const d=a("client");class h{constructor(e){this.scene=e}connect(){return e=this,t=void 0,o=function*(){let e="wss://zshwx1.colyseus.de";/localhost/.test(window.location.host)&&(e="ws://localhost:2567"),d("connecting to server url %s",e);const t=new s.Client(e);let i;this.room=yield t.joinOrCreate("gameRoom"),d(this.room.sessionId,"joined",this.room.id,this.room.name),this.room.onStateChange((e=>{})),this.room.onMessage("message",(e=>{})),this.room.state.listen("tileMap",(e=>{e.mapSize.onChange=()=>{i&&i.destroy(),i=this.scene.add.rectangle(0,0,this.room.state.tileMap.mapSize.width*e.tileSize,this.room.state.tileMap.mapSize.height*e.tileSize,13421772),i.setDepth(-1),this.scene.scale.setGameSize(this.room.state.tileMap.mapSize.width*e.tileSize,this.room.state.tileMap.mapSize.height*e.tileSize),this.scene.cameras.main.centerOn(0,0)}})),this.room.state.players.onAdd=e=>{d("added new player with id",e.id),this.room.sessionId===e.id&&(d("found own player with id %s",e.id),this.ownPlayer=e),e.onChange=e=>{e.forEach((e=>{d(e.field),d(e.value),d(e.previousValue)}))},e.onRemove=()=>{d("player",e.id,"removed")},e.triggerAll()},this.room.state.bodies.onAdd=e=>function(e,t){l("added new body with id",t.id);const i=new c(e,200,200);let n,s;t.position.listen("x",(e=>i.setX(e))),t.position.listen("y",(e=>i.setY(e))),t.moveDirection.onChange=()=>{0===t.moveDirection.x&&0===t.moveDirection.y||(l("setting rotation %j",t.moveDirection),i.setRotation(new Phaser.Math.Vector2(t.moveDirection).angle()))};const o=()=>{s&&(l("destroying particles"),s.destroy(),s=void 0,n=void 0)};t.onRemove=()=>{l("player",t.id,"removed"),i.destroy(),o()},t.listen("isCatcher",(t=>{t?(n&&s||(s=e.add.particles("particle.red"),n=s.createEmitter({})),n.setScale(.3),n.setSpeed(30),n.setLifespan(100),n.setBlendMode(Phaser.BlendModes.ADD),n.startFollow(i),s.setDepth(90)):s&&o()})),t.triggerAll()}(this.scene,e);const o=this.scene.add.group();return this.room.state.listen("tileMap",(e=>{e.mapSize.width,e.tileSize,e.mapSize.height,e.tileSize;const t=-e.mapSize.width*e.tileSize*.5,i=-e.mapSize.height*e.tileSize*.5;e.listen("tiles",(s=>{s.onAdd=(s,r)=>{let a;s.listen("texture",(()=>{a&&(o.remove(a,!0,!0),a=void 0),a=new n.GameObjects.Image(this.scene,t+s.position.x*e.tileSize,i+s.position.y*e.tileSize,s.texture.key,s.texture.frameKey||s.texture.frameIndex),a.setDisplaySize(e.tileSize,e.tileSize),a.setDepth(s.layer||20),a.setOrigin(0,0),o.add(a),this.scene.add.existing(a)})),d("new tile %s",r),s.onRemove=()=>{a&&(o.remove(a,!0,!0),a=void 0,d("removed tile %s",r))}}}))})),this.room},new((i=void 0)||(i=Promise))((function(n,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}));var e,t,i,o}}const p=a("input");class u extends Phaser.Scene{constructor(){super({key:"HudScene"})}create(){return e=this,t=void 0,n=function*(){this.energyText=this.add.text(0,0,"",{color:"black",fontSize:"28px"}),this.energyText.setOrigin(0,0)},new((i=void 0)||(i=Promise))((function(s,o){function r(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((n=n.apply(e,t||[])).next())}));var e,t,i,n}updateEnergy(e,t){this.energyText.setText(`Energy: ${Math.floor(e)}/${Math.floor(t)}`)}}class m extends Phaser.Scene{constructor(){super({key:"GameScene"})}create(){return e=this,t=void 0,n=function*(){this.cameras.main.centerOn(0,0),this.hudScene=this.scene.add("HudScene",u,!0),this.network=new h(this),this.room=yield this.network.connect(),function(e,t){const{up:i,down:n,left:s,right:o,space:r}=e.input.keyboard.createCursorKeys();let a={up:!1,down:!1,left:!1,right:!1},c=!1;e.events.on("update",(()=>{const e={up:i.isDown,down:n.isDown,left:s.isDown,right:o.isDown};e.left===a.left&&e.right===a.right&&e.down===a.down&&e.up===a.up||(a=e,t.send("direction",e),p("sent new direction %j",e)),c!==r.isDown&&(c=r.isDown,r.isDown?(p("sprinting"),t.send("sprint",!0)):(p("stop sprinting"),t.send("sprint",!1)))}))}(this,this.room)},new((i=void 0)||(i=Promise))((function(s,o){function r(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((n=n.apply(e,t||[])).next())}));var e,t,i,n}update(){if(this.network.ownPlayer){const e=this.room.state.bodies.get(this.network.ownPlayer.bodyId);e&&this.hudScene.updateEnergy(e.energy,e.maxEnergy)}}}class g extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.image("body.blue.1","assets/sprites/body.blue.1.png"),this.load.image("particle.red","assets/particles/red.png"),this.load.image("tile.wall.1","assets/sprites/tile.wall.png"),this.load.image("tile.dirt","assets/sprites/dirt.png"),this.load.image("tile.tree","assets/sprites/treeSmall.png"),this.load.spritesheet("tilesheet.grass","assets/tilesheets/groundGrass.png",{frameWidth:64,frameHeight:64})}create(){this.scene.start("GameScene")}}const w={type:Phaser.AUTO,backgroundColor:"#333333",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1280,height:720},scene:[g,m]};window.addEventListener("load",(()=>{new Phaser.Game(w)}))}},i={};function n(e){var s=i[e];if(void 0!==s)return s.exports;var o=i[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}n.m=t,e=[],n.O=(t,i,s,o)=>{if(!i){var r=1/0;for(d=0;d<e.length;d++){for(var[i,s,o]=e[d],a=!0,c=0;c<i.length;c++)(!1&o||r>=o)&&Object.keys(n.O).every((e=>n.O[e](i[c])))?i.splice(c--,1):(a=!1,o<r&&(r=o));if(a){e.splice(d--,1);var l=s();void 0!==l&&(t=l)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[i,s,o]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};n.O.j=t=>0===e[t];var t=(t,i)=>{var s,o,[r,a,c]=i,l=0;if(r.some((t=>0!==e[t]))){for(s in a)n.o(a,s)&&(n.m[s]=a[s]);if(c)var d=c(n)}for(t&&t(i);l<r.length;l++)o=r[l],n.o(e,o)&&e[o]&&e[o][0](),e[r[l]]=0;return n.O(d)},i=self.webpackChunk_catchme4_client=self.webpackChunk_catchme4_client||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var s=n.O(void 0,[216],(()=>n(840)));s=n.O(s)})();